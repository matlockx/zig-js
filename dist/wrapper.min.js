!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=38)}([function(e,t,n){var r,o;r=[n,t,n(1)],void 0===(o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];n.Options.logging&&console.log.apply(console,[e].concat(t))}},t.sleep=function(e){return new Promise(function(t){return window.setTimeout(t,e)})}}.apply(t,r))||(e.exports=o)},function(e,t,n){var r,o;r=[n,t,n(2)],void 0===(o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Options={get logging(){return!0===n.KV.get("logging")},set logging(e){n.KV.set("logging",e)},get version(){return n.KV.get("version")||"latest"},set version(e){n.KV.set("version",e)},get winningClassOverride(){return n.KV.get("winning-class-override")},set winningClassOverride(e){n.KV.set("winning-class-override",e)},get debuggingLayer(){return this.logging||"latest"!==this.version||null!=this.winningClassOverride}}}.apply(t,r))||(e.exports=o)},function(e,t,n){var r;void 0===(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KV={set:function(e,t){try{localStorage.setItem("kv."+e,JSON.stringify(t))}catch(n){console.log("Could not store KV:",e,t,n)}},get:function(e){try{var t=localStorage.getItem("kv."+e)||"null";return JSON.parse(t)}catch(t){return console.log("Could not read KV:",e,t),null}}}}.apply(t,[n,t]))||(e.exports=r)},function(e,t,n){var r;void 0===(r=function(e,t){"use strict";function n(e){return btoa(JSON.stringify(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.parseGameConfigFromURL=function(e){void 0===e&&(e=location.href);var t=/[?#].*\bconfig=([a-zA-Z0-9+/]+=*)/.exec(e);if(null==t)throw new Error("No config parameter found.");var n=t[1],r=JSON.parse(atob(n));if("string"!=typeof r.canonicalGameName)throw new Error("canonicalGameName not set in config.");return r},t.serializeGameConfig=n,t.appendGameConfigToURL=function(e,t){return e+(-1!==e.indexOf("#")?"&":"#")+"config="+n(t)}}.apply(t,[n,t]))||(e.exports=r)},function(e,t,n){var r,o;r=[n,t,n(0)],void 0===(o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n.logger("[zig-msg]"),o=function(){function e(e){var t=this;this.partnerWindow=e,this.handlers={},this.eventHandler=function(e){return t.handleEvent(e)},window.addEventListener("message",this.eventHandler)}return e.prototype.close=function(){window.removeEventListener("message",this.eventHandler)},e.prototype.send=function(e){null!=e&&(r("Send message of type "+(e.command||e),e),this.partnerWindow.postMessage(e,"*"))},e.prototype.sendError=function(e){var t=i(e);null!=t&&(r("Sending error value:",t),this.partnerWindow.postMessage(t,"*"))},e.prototype.register=function(e,t){this.handlers[e]=(this.handlers[e]||[]).concat(t)},e.prototype.unregister=function(e,t){this.handlers[e]=(this.handlers[e]||[]).filter(function(e){return e!==t})},e.prototype.registerWildcard=function(e){this.register("*",e)},e.prototype.handleEvent=function(e){try{if(e.source!==this.partnerWindow)throw new Error("do not optimize away the try/catch.")}catch(e){return}var t="string"==typeof e.data?e.data:(e.data||{}).command;if(null==t&&e.data&&null!=e.data.type&&(t="error"),"string"==typeof t){var n=e.data,r=this.handlers[t]||[];r&&r.length?this.dispatch(n,r):this.dispatch(n,this.handlers["*"]||[])}},e.prototype.dispatch=function(e,t){t.forEach(function(t){try{t(e)}catch(t){r("Error in handling message "+e+":",t)}})},e}();function i(e){if(null==e)return null;if(e.type&&e.title&&void 0!==e.status&&void 0!==e.details)return e;if("string"==typeof e.type&&"string"==typeof e.message)return{type:"urn:x-tipp24:remote-client-error",title:"Remote error",status:e.type,details:e.message};var t=e.responseText||e.body;if("string"==typeof t)try{var n=JSON.parse(t);if(n.error&&n.status)return{type:"urn:x-tipp24:remote-client-error",title:"Remote error",details:n.error,status:n.status};if(n.type&&n.title&&n.details)return n}catch(e){}return{type:"urn:x-tipp24:remote-client-error",title:"Remote error",status:500,details:e.toString()}}t.MessageClient=o,t.toErrorValue=i}.apply(t,r))||(e.exports=o)},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r;void 0===(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.__zig_events=window.__zig_events||{};function r(e,t){return n[t]||("interactive"===document.readyState&&(n.DOMContentLoaded=!0),e.addEventListener(t,function(){n[t]=!0})),function(r){n[t]?window.setTimeout(r,0):e.addEventListener(t,r)}}t.onDOMLoad=r(document,"DOMContentLoaded"),t.onLoad=r(window,"load")}.apply(t,[n,t]))||(e.exports=r)},function(e,t,n){"use strict";(function(e){var n=setTimeout;function r(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void u(t.promise,e)}a(t.promise,r)}else(1===e._state?a:u)(t.promise,e._value)})):e._deferreds.push(t)}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void s(e);if("function"==typeof n)return void c((r=n,i=t,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=t,s(e)}catch(t){u(e,t)}var r,i}function u(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,u(t,e))})}catch(e){if(n)return;n=!0,u(t,e)}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=new this.constructor(r);return i(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,t,n)),n},o.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},o.all=function(e){return new o(function(t,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);var o=r.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){i(e,t)},n)}r[e]=a,0==--o&&t(r)}catch(e){n(e)}}for(var a=0;a<r.length;a++)i(a,r[a])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var r=0,o=e.length;r<o;r++)e[r].then(t,n)})},o._immediateFn="function"==typeof e&&function(t){e(t)}||function(e){n(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},t.a=o}).call(this,n(13).setImmediate)},,,function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(a=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(i).concat([o]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(r[i]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,c=[],l=!1,f=-1;function d(){l&&s&&(l=!1,s.length?c=s.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=u(d);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new g(e,t)),1!==c.length||l||u(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,o,i,a,u,s=1,c={},l=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){g(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){g(e.data)},r=function(e){i.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){g(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):r=function(e){setTimeout(g,0,e)}:(a="setImmediate$"+Math.random()+"$",u=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&g(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",u,!1):e.attachEvent("onmessage",u),r=function(t){e.postMessage(a+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return c[s]=o,r(s),s++},d.clearImmediate=p}function p(e){delete c[e]}function g(e){if(l)setTimeout(g,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(5),n(11))},function(e,t,n){(function(e){var r=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(12),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(5))},function(e,t,n){"use strict";n.r(t);var r=n(7),o=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==o)return o;throw new Error("unable to locate global object")}();o.Promise||(o.Promise=r.a)},function(e,t,n){var r,o;r=[n,t,n(0),n(1)],void 0===(o=function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delegateToVersion=function(e){var t=n.logger("[delegate]");if(window.__zig_delegated)return!1;window.__zig_delegated=!0;var o=r.Options.version;if(null==o||"latest"===o)return!1;var i="https://lib.zig.services/"+o+"/"+e;if(t("Delegate script "+e+" to "+i),"loading"===document.readyState)document.write('<script src="'+i+'"><\/script>');else{var a=document.createElement("script");a.src=i,a.async=!1,a.defer=!1,document.body.appendChild(a)}return!0}}.apply(t,r))||(e.exports=o)},function(e,t,n){var r;void 0===(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clientVersion="0.3.3",t.buildTime=1521461701655}.apply(t,[n,t]))||(e.exports=r)},function(e,t,n){var r;void 0===(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectStyle=function(e){var t=document.createElement("style");t.textContent=e,document.body.appendChild(t)}}.apply(t,[n,t]))||(e.exports=r)},,,,,,,,,,,,,,,,,,,,function(e,t,n){(e.exports=n(10)(!1)).push([e.i,"body,html,iframe{width:100vw;height:100vh;border:0;margin:0;padding:0;font-family:sans-serif}.zig-overlay{top:0;width:100vw;height:100vh;background:rgba(0,0,0,.2)}.zig-alert,.zig-overlay{position:absolute;left:0}.zig-alert{z-index:1;margin-left:auto;margin-right:auto;right:0;top:3em;width:80%;max-width:20em;background:#fff;box-shadow:0 0 .5em rgba(0,0,0,.25);padding:1em;border-radius:.25em;color:#000}.zig-alert__title{font-size:1.33em;font-weight:700}.zig-alert__text,.zig-alert__title{padding-bottom:.33em}.zig-alert__button{color:#000;font-weight:700;text-decoration:none;float:right;padding:.25em}.zig-alert__button:hover{color:#f08;background:#eee}.zig-start-button{position:absolute;display:block;right:4em;bottom:4em;padding:1em;background:#fff;box-shadow:0 0 .5em rgba(0,0,0,.25);color:#000;font-weight:700;text-decoration:none}",""])},function(e,t,n){var r,o,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};r=[n,t,n(0),n(4),n(17),n(16),n(15),n(6),n(1),n(3),n(14)],void 0===(o=function(e,t,r,o,u,s,c,l,f,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=r.logger("[zig-wrapper]"),g=window.GameSettings;if(null==g)throw new Error("window.GameConfig must be initialized.");function h(){return i(this,void 0,void 0,function(){function e(){return i(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return null!=u.contentWindow?[3,2]:(p("contentWindow not yet available, waiting..."),[4,r.sleep(250)]);case 1:return t.sent(),[3,0];case 2:return e=new o.MessageClient(u.contentWindow),function(e,t){t.registerWildcard(function(t){p("Proxy message parent <- game"),e.send(t)}),e.registerWildcard(function(e){p("Proxy message parent -> game"),t.send(e)}),d.parseGameConfigFromURL().overlay&&(p("Register messages listeners for overlay"),t.register("gameLoaded",function(){return m(t)}),t.register("gameFinished",function(){return m(t)}),t.register("error",function(e){return function(e){var t=e.details;"urn:x-tipp24:remote-client-error"===e.type&&(t="An error occurred while communicating with the game backend, please try again.");var n=document.createElement("div");n.innerHTML="\n      <div class='zig-overlay'>\n        <div class='zig-alert'>\n          <div class='zig-alert__title'></div>\n          <div class='zig-alert__text'></div>\n          <a href='#' class='zig-alert__button'>Close</a>\n        </div>\n      </div>",n.querySelector(".zig-alert__title").innerText=e.title,n.querySelector(".zig-alert__text").innerText=t,n.querySelector(".zig-alert__button").onclick=function(){return n.parentNode.removeChild(n)},document.body.appendChild(n)}(e)}))}(s,e),window.onfocus=function(){p("got focus, focusing iframe now."),setTimeout(function(){return u.contentWindow.focus()},100)},[2]}})})}var t,n,u,s;return a(this,function(r){switch(r.label){case 0:return t=d.parseGameConfigFromURL(),n=d.appendGameConfigToURL("inner.html",t),!0===g.legacyGame&&(n+="&legacyGame=true"),p("Creating iframe with URL "+n),(u=document.createElement("iframe")).src=n,u.allowFullscreen=!0,u.scrolling="no",(s=new o.MessageClient(window.parent)).send({command:"updateGameSettings",gameSettings:g}),document.body.appendChild(u),[4,e()];case 1:return r.sent(),[2,u]}})})}function m(e){if(null==document.querySelector(".zig-start-button")){var t=document.createElement("a");t.className="zig-start-button",t.innerText="Start game",t.href="#",document.body.appendChild(t),t.onclick=function(n){n.preventDefault(),e.send("playGame"),t.parentNode.removeChild(t)}}}l.onDOMLoad(function(){p("Initializing zig wrapper in "+s.clientVersion),c.delegateToVersion("wrapper.min.js")||function(){var e=f.Options.winningClassOverride;if(null==e)return!1;var t="&wc="+e.winningClass+"&scenario="+e.scenarioId;if(-1===location.href.indexOf(t)){var n=location.href.replace(/\b(scenario|wc)=[^&]+/g,"")+t;return p("Reload outer.html with updated url:",n),location.href=n,!0}return!1}()||(u.injectStyle(n(37)),h(),f.Options.debuggingLayer&&(p("Debugging options are set, showing debugging layer now."),document.body.style.borderTop="0.5em solid red"))})}.apply(t,r))||(e.exports=o)}]);